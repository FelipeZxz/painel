<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ff7e00">
    <title>Painel de Controle - Auxílio Free Fire</title>
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #0a0a0a;
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }
        
        #particles-js {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        
        .container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 500px;
            margin: 30px auto;
            background: rgba(15, 15, 15, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        header h1 {
            font-size: 2rem;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #ff7e00, #ff0080, #ff7e00);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        header p {
            color: #aaa;
            font-size: 1.1rem;
        }
        
        .user-info {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(45, 45, 45, 0.5);
            border-radius: 10px;
        }
        
        .user-info p {
            margin: 8px 0;
        }
        
        .key-value {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #ff7e00;
        }
        
        .status-connected {
            color: #00c853;
            font-weight: bold;
        }
        
        .status-error {
            color: #ff453a;
            font-weight: bold;
        }
        
        .collapsible-tab {
            margin-bottom: 15px;
            border-radius: 10px;
            overflow: hidden;
            background: rgba(35, 35, 35, 0.6);
        }
        
        .collapsible-tab-header {
            padding: 15px;
            background: rgba(70, 70, 70, 0.7);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .collapsible-tab-header h3 {
            font-size: 1.1rem;
            color: #ff7e00;
            margin: 0;
        }
        
        .collapsible-tab-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .collapsible-tab-content.open {
            max-height: 500px;
        }
        
        .checkbox-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .checkbox-item:last-child {
            border-bottom: none;
        }
        
        .checkbox-item input[type="checkbox"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            accent-color: #ff7e00;
        }
        
        .checkbox-item label {
            color: #e2e8f0;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ff7e00, #ff0080);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 126, 0, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .active-features {
            margin-top: 20px;
            padding: 15px;
            background: rgba(40, 40, 40, 0.6);
            border-radius: 10px;
            border-left: 4px solid #00c853;
        }
        
        .active-features h3 {
            color: #00c853;
            margin-bottom: 8px;
        }
        
        .tab-indicator {
            transition: transform 0.3s;
        }
        
        .rotate {
            transform: rotate(180deg);
        }
        
        .timer-warning {
            color: #ff453a !important;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .access-denied {
            text-align: center;
            padding: 30px 20px;
        }
        
        .access-denied h2 {
            color: #ff453a;
            margin-bottom: 15px;
        }
        
        .hidden {
            display: none;
        }
        
        .sync-status {
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }
        
        .sync-status.success {
            background: rgba(0, 200, 83, 0.2);
            color: #00c853;
            display: block;
        }
        
        .sync-status.error {
            background: rgba(255, 69, 58, 0.2);
            color: #ff453a;
            display: block;
        }
    </style>
</head>
<body>
    <div id="particles-js"></div>

    <div class="container">
        <div id="syncStatus" class="sync-status"></div>
        
        <div id="accessDenied" class="access-denied hidden">
            <h2>Acesso Negado</h2>
            <p>Sua sessão expirou ou a key é inválida.</p>
            <button class="btn" onclick="redirectToLogin()">Voltar para Login</button>
        </div>

        <div id="panelContent">
            <header>
                <h1>PAINEL FREE FIRE</h1>
                <p>Bem-vindo ao sistema de auxílio Free Fire</p>
            </header>
            
            <div class="user-info">
                <p>Key utilizada: <span class="key-value" id="userKey">Carregando...</span></p>
                <p>Status: <span class="status-connected" id="statusText">Verificando...</span></p>
                <p>Tempo restante: <span id="timeRemaining">00:00:00</span></p>
            </div>
            
            <div class="collapsible-tab">
                <div class="collapsible-tab-header" onclick="toggleTab('tab1')">
                    <h3>Opções de Gameplay</h3>
                    <span id="tab1Indicator" class="tab-indicator">▼</span>
                </div>
                <div id="tab1Content" class="collapsible-tab-content">
                    <ul class="checkbox-list">
                        <li class="checkbox-item">
                            <input type="checkbox" id="option1">
                            <label for="option1">Sistema Avançado</label>
                        </li>
                        <li class="checkbox-item">
                            <input type="checkbox" id="option2">
                            <label for="option2">120 FPS</label>
                        </li>
                        <li class="checkbox-item">
                            <input type="checkbox" id="option3">
                            <label for="option3">No Recoil</label>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="collapsible-tab">
                <div class="collapsible-tab-header" onclick="toggleTab('tab2')">
                    <h3>Opções de Mira</h3>
                    <span id="tab2Indicator" class="tab-indicator">▼</span>
                </div>
                <div id="tab2Content" class="collapsible-tab-content">
                    <ul class="checkbox-list">
                        <li class="checkbox-item">
                            <input type="checkbox" id="option4">
                            <label for="option4">Nova Seção</label>
                        </li>
                        <li class="checkbox-item">
                            <input type="checkbox" id="option5">
                            <label for="option5">Aimbot 90%</label>
                        </li>
                        <li class="checkbox-item">
                            <input type="checkbox" id="option6">
                            <label for="option6">Head Trick</label>
                        </li>
                        <li class="checkbox-item">
                            <input type="checkbox" id="option7">
                            <label for="option7">Neural Aim</label>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div id="activeFeatures" class="active-features">
                <h3>Recursos Ativados:</h3>
                <p id="activeFeaturesList">Nenhum recurso ativado</p>
            </div>
            
            <button class="btn" onclick="activateSelected()">Ativar Selecionados</button>
            <button class="btn btn-secondary" onclick="logout()">Sair do Painel</button>
        </div>
    </div>

    <script>
        // Configuração das partículas
        particlesJS('particles-js', {
            "particles": {
                "number": {
                    "value": 100,
                    "density": {
                        "enable": true,
                        "value_area": 800
                    }
                },
                "color": {
                    "value": "#ff7e00"
                },
                "shape": {
                    "type": "circle"
                },
                "opacity": {
                    "value": 0.5,
                    "random": true
                },
                "size": {
                    "value": 3,
                    "random": true
                },
                "line_linked": {
                    "enable": true,
                    "distance": 150,
                    "color": "#ff7e00",
                    "opacity": 0.4,
                    "width": 1
                },
                "move": {
                    "enable": true,
                    "speed": 2,
                    "direction": "none",
                    "random": true,
                    "straight": false,
                    "out_mode": "out",
                    "bounce": false
                }
            },
            "interactivity": {
                "detect_on": "canvas",
                "events": {
                    "onhover": {
                        "enable": true,
                        "mode": "grab"
                    },
                    "onclick": {
                        "enable": true,
                        "mode": "push"
                    }
                }
            }
        });

        // Sistema de armazenamento sincronizado (igual ao index.html)
        const MASTER_STORAGE_KEY = 'ff_master_keys';
        const SYNC_STORAGE_KEY = 'ff_sync_keys';

        // Variáveis globais
        let timerInterval;
        let currentKey = '';

        // Obter todas as keys do sistema master
        function getAllKeys() {
            try {
                // Primeiro tenta do localStorage
                let keys = JSON.parse(localStorage.getItem(MASTER_STORAGE_KEY) || '[]');
                
                // Se não houver keys no localStorage, tenta do sessionStorage
                if (keys.length === 0) {
                    try {
                        keys = JSON.parse(sessionStorage.getItem(SYNC_STORAGE_KEY) || '[]');
                        // Se encontrou no sessionStorage, salva no localStorage
                        if (keys.length > 0) {
                            localStorage.setItem(MASTER_STORAGE_KEY, JSON.stringify(keys));
                        }
                    } catch (e) {
                        console.log('Não foi possível ler do sessionStorage');
                    }
                }
                
                return keys;
            } catch (e) {
                console.error('Erro ao ler keys:', e);
                return [];
            }
        }

        // Salvar todas as keys no sistema master
        function saveAllKeys(keys) {
            try {
                localStorage.setItem(MASTER_STORAGE_KEY, JSON.stringify(keys));
                // Também sincroniza com sessionStorage
                sessionStorage.setItem(SYNC_STORAGE_KEY, JSON.stringify(keys));
            } catch (e) {
                console.error('Erro ao salvar keys:', e);
            }
        }

        // Verificar se key é válida
        function isKeyValid(keyValue) {
            const keys = getAllKeys();
            const agora = Date.now();
            
            const keyData = keys.find(k => k.key_value === keyValue);
            return keyData && keyData.is_active && keyData.expiration > agora;
        }

        // Remover key do sistema master
        function removeKeyFromMaster(keyValue) {
            const keys = getAllKeys();
            const updatedKeys = keys.filter(k => k.key_value !== keyValue);
            saveAllKeys(updatedKeys);
            
            return updatedKeys;
        }

        // Obter tempo restante de uma key
        function getTempoRestante(keyValue) {
            const keys = getAllKeys();
            const agora = Date.now();
            
            for (const keyData of keys) {
                if (keyData.key_value === keyValue) {
                    return Math.max(0, Math.floor((keyData.expiration - agora) / 1000));
                }
            }
            
            return 0;
        }

        // Sincronizar com o index.html para garantir compatibilidade
        function synchronizeWithIndex() {
            try {
                // Tenta acessar o localStorage do index.html via iframe
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = 'index.html';
                
                iframe.onload = function() {
                    try {
                        const indexKeys = JSON.parse(iframe.contentWindow.localStorage.getItem(MASTER_STORAGE_KEY) || '[]');
                        const currentKeys = getAllKeys();
                        
                        // Se não houver keys atuais, usa as do index
                        if (currentKeys.length === 0 && indexKeys.length > 0) {
                            saveAllKeys(indexKeys);
                            showSyncStatus('Keys sincronizadas com sucesso!', 'success');
                            // Recarrega a verificação de acesso
                            verificarAcesso();
                        } else if (indexKeys.length > 0) {
                            // Combinar as keys para garantir sincronia
                            const combinedKeys = [...currentKeys];
                            
                            indexKeys.forEach(indexKey => {
                                if (!combinedKeys.some(k => k.key_value === indexKey.key_value)) {
                                    combinedKeys.push(indexKey);
                                }
                            });
                            
                            saveAllKeys(combinedKeys);
                            showSyncStatus('Keys sincronizadas com sucesso!', 'success');
                        }
                    } catch (e) {
                        console.log('Não foi possível sincronizar com o index');
                        showSyncStatus('Erro na sincronização. Verifique a conexão.', 'error');
                    }
                };
                
                document.body.appendChild(iframe);
                setTimeout(() => {
                    if (document.body.contains(iframe)) {
                        document.body.removeChild(iframe);
                    }
                }, 2000);
            } catch (e) {
                console.log('Sincronização com index não permitida');
                showSyncStatus('Sincronização não disponível neste modo.', 'error');
            }
        }

        // Mostrar status de sincronização
        function showSyncStatus(message, type) {
            const statusElement = document.getElementById('syncStatus');
            statusElement.textContent = message;
            statusElement.className = 'sync-status ' + type;
            
            setTimeout(() => {
                statusElement.className = 'sync-status';
            }, 3000);
        }

        // Função para alternar abas
        function toggleTab(tabId) {
            const content = document.getElementById(tabId + 'Content');
            const indicator = document.getElementById(tabId + 'Indicator');
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                indicator.classList.remove('rotate');
            } else {
                content.classList.add('open');
                indicator.classList.add('rotate');
            }
        }
        
        // Função para atualizar recursos ativados
        function updateActiveFeatures() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            let activeFeatures = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    activeFeatures.push(checkbox.nextElementSibling.textContent);
                }
            });
            
            const activeFeaturesList = document.getElementById('activeFeaturesList');
            const activeFeaturesContainer = document.getElementById('activeFeatures');
            
            if (activeFeatures.length > 0) {
                activeFeaturesList.textContent = activeFeatures.join(', ');
                activeFeaturesContainer.style.display = 'block';
            } else {
                activeFeaturesList.textContent = 'Nenhum recurso ativado';
                activeFeaturesContainer.style.display = 'none';
            }
        }
        
        // Função para ativar selecionados
        function activateSelected() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            let selectedCount = 0;
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) selectedCount++;
            });
            
            if (selectedCount > 0) {
                updateActiveFeatures();
                alert(selectedCount + ' recurso(s) ativado(s) com sucesso!');
            } else {
                alert('Selecione pelo menos uma opção!');
            }
        }
        
        // Função de logout
        function logout() {
            if (confirm('Tem certeza que deseja sair do painel?')) {
                if (timerInterval) clearInterval(timerInterval);
                window.location.href = 'index.html';
            }
        }
        
        // Função para redirecionar para login
        function redirectToLogin() {
            if (timerInterval) clearInterval(timerInterval);
            window.location.href = 'index.html';
        }
        
        // Função do cronômetro
        function startTimer(duration) {
            let timer = duration;
            const timerElement = document.getElementById('timeRemaining');
            const statusElement = document.getElementById('statusText');
            
            // Atualizar imediatamente
            const hours = Math.floor(timer / 3600);
            const minutes = Math.floor((timer % 3600) / 60);
            const seconds = timer % 60;
            timerElement.textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            timerInterval = setInterval(function() {
                const hours = Math.floor(timer / 3600);
                const minutes = Math.floor((timer % 3600) / 60);
                const seconds = timer % 60;
                
                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Alerta visual quando restam 5 minutos
                if (timer <= 300) {
                    timerElement.classList.add('timer-warning');
                    statusElement.textContent = 'Expirando em breve';
                    statusElement.className = 'status-error';
                }
                
                if (--timer < 0) {
                    clearInterval(timerInterval);
                    showAccessDenied();
                }
            }, 1000);
        }
        
        // Função para mostrar acesso negado
        function showAccessDenied() {
            document.getElementById('panelContent').style.display = 'none';
            document.getElementById('accessDenied').style.display = 'block';
        }
        
        // Função para verificar acesso
        function verificarAcesso() {
            const urlParams = new URLSearchParams(window.location.search);
            const key = urlParams.get('key');
            
            if (key && isKeyValid(key)) {
                currentKey = key;
                document.getElementById('userKey').textContent = key;
                document.getElementById('statusText').textContent = 'Conectado';
                document.getElementById('statusText').className = 'status-connected';
                
                const tempoRestante = getTempoRestante(key);
                if (tempoRestante > 0) {
                    startTimer(tempoRestante);
                    
                    // Abrir as abas automaticamente
                    setTimeout(() => {
                        toggleTab('tab1');
                        toggleTab('tab2');
                    }, 300);
                } else {
                    // Key expirada - remover do sistema
                    removeKeyFromMaster(key);
                    showAccessDenied();
                }
            } else {
                // Se não encontrou a key válida, tenta sincronizar com o index
                synchronizeWithIndex();
                
                // Tenta novamente após sincronização
                setTimeout(() => {
                    if (key && isKeyValid(key)) {
                        currentKey = key;
                        document.getElementById('userKey').textContent = key;
                        document.getElementById('statusText').textContent = 'Conectado';
                        document.getElementById('statusText').className = 'status-connected';
                        
                        const tempoRestante = getTempoRestante(key);
                        if (tempoRestante > 0) {
                            startTimer(tempoRestante);
                        } else {
                            showAccessDenied();
                        }
                    } else {
                        showAccessDenied();
                    }
                }, 1000);
            }
        }
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Prevenir zoom e comportamentos indesejados
            document.addEventListener('touchmove', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            // Forçar modo tela cheia em dispositivos móveis
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                document.documentElement.style.height = '100%';
                document.body.style.height = '100%';
                document.getElementById('userKey').textContent = 'Modo Tela Inicial';
            }
            
            // Verificar acesso
            verificarAcesso();
            
            // Adicionar event listeners para os checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateActiveFeatures);
            });
            
            // Inicializar estado dos recursos ativados
            updateActiveFeatures();
        });

        // Prevenir que a página seja acessada sem uma key válida
        window.addEventListener('beforeunload', function() {
            if (timerInterval) clearInterval(timerInterval);
        });
    </script>
</body>
</html>